---


- name: Test Ops | Native Assets
  block:
    - name: Test Ops | Policy | Verification key stats as seen by the cardano user
      become: true
      become_user: "{{ cardano_user }}"
      stat:
        path: "{{ cardano_policy_fullpath }}/{{ cardano_policy_vkey_file }}"
      register: vkey_stat

    - name: Test Ops | Policy | Signing key stats as seen by the cardano user
      become: true
      become_user: "{{ cardano_user }}"
      stat:
        path: "{{ cardano_policy_fullpath }}/{{ cardano_policy_skey_file }}"
      register: skey_stat

    - name: Test Ops | Policy | Script file as seen by the cardano user
      become: true
      become_user: "{{ cardano_user }}"
      stat:
        path: "{{ cardano_policy_fullpath }}/{{ cardano_policy_script_file }}"
      register: script_stat

    - name: Test Ops | Policy | ID file as seen by the cardano user
      become: true
      become_user: "{{ cardano_user }}"
      stat:
        path: "{{ cardano_policy_fullpath }}/{{ cardano_policy_id_file }}"
      register: id_stat

    - assert:
        that:
          - vkey_stat.stat.exists
          - skey_stat.stat.exists
          - script_stat.stat.exists
          - id_stat.stat.exists
          - vkey_stat.stat.isreg
          - skey_stat.stat.isreg
          - script_stat.stat.isreg
          - id_stat.stat.isreg
          - vkey_stat.stat.readable
          - skey_stat.stat.readable
          - script_stat.stat.readable
          - id_stat.stat.readable
          - vkey_stat.stat.size > 10   # arbitrary heuristic, just to make sure it's not an empty file
          - skey_stat.stat.size > 10
          - script_stat.stat.size > 10
          - id_stat.stat.size > 10
